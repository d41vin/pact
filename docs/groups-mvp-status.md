# Pact Groups MVP — Status Report

This document summarizes the work completed for the Groups MVP, what remains to be done according to the brief, open questions, and recommendations for improvements.


## What’s Implemented

- Database schema additions (Convex)
  - groups: core group entity with name, description, imageUrl/emoji, accentColor, creatorId, createdAt, privacy, joinMethod.
  - groupMembers: membership with role (admin/member), joinedAt, invitedBy + indexes for lookups.
  - groupInvitations: invite tracking with status (invited/accepted/cancelled).
  - groupActivities: activity log with type, metadata, createdAt + index by group.
  - pacts and groupPacts: blueprint and instance separation with basic indexes.
- Convex functions (backend)
  - createGroup: creates a group, uploads optional image, adds creator as admin, logs member_joined activity, enforces unique group name per creator.
  - updateGroup: admin-only update for name/description/accentColor/image/emoji/privacy/joinMethod and logs settings_changed activity.
  - listUserGroups: lists all groups for a given user with a small member preview and normalized fields used by UI.
  - listPublicByUsername: lists public groups for a specific username (for profile pages) with member preview; hides private groups for non-members.
  - getGroup: fetch group by id.
  - getGroupMembers: fetch members populated with user data.
  - getUserMembership: fetch membership/role for a user in a group.
  - getGroupActivities: per-group activity, newest first with limit.
  - listGlobalActivityForUser: merges activities across the user’s groups (limited for the global feed on /groups).
- Frontend pages and components (Next.js App Router)
  - /groups page
    - Create Group button that opens a modal.
    - Recent Activity (global feed across user’s groups, limited).
    - Your Groups grid of group cards with accent background, avatar stack preview, and navigation to /groups/[groupId].
  - CreateGroupModal component
    - Fields: name (required, uniq per creator), description (optional, 300 char max), accent color palette, image upload (Convex storage), emoji input (simple text field), basic validations.
    - Submits to Convex: storage.generateUploadUrl + groups.createGroup. Defaults: privacy public, joinMethod invite.
    - Post-create navigation to /groups/[id].
  - /groups/[groupId] page
    - Group profile header: name, description, image/emoji, accent-colored header, member avatar stack preview.
    - Buttons: Create / Use Pact and Group Settings (placeholders for now).
    - Tabs: Activity (functional), Pacts (WIP placeholder), Chat (WIP placeholder).
    - Access component for non-members: shows request/join options as placeholders; if not logged in, prompts login.
  - PublicGroups component on profile pages
    - Replaced mock with Convex query to list public groups by username.
    - Card UI consistent with /groups cards and navigates to /groups/[id].
- Generated API typings
  - Explicitly referenced convex/groups module in convex/_generated/api.d.ts (note: this file is typically generated by Convex; see Caveats below).


## What’s Left (from the Brief)

- Invitations and membership flows
  - Full invite flow (from a user’s profile: “Send Group Invite” modal listing groups, invite/cancel states, notifications on send/cancel/accept).
  - Accept/Cancel invitation mutations; membership creation on accept; corresponding notifications and activity logs.
  - Admin remove member; user leaves group with creator/admin constraints; confirmation dialogs.
  - Rejoin rules (only via new invite after removal).
- Access & privacy
  - Request Access flow: create a requests table or reuse invitations with a “request” type; admin approval UI and mutations.
  - Invite Code flow: code generation/validation, join via code.
  - NFT gating: token verification action + UI flow (placeholder acceptable for MVP if not implementing chain calls yet).
  - Ensure private groups are fully hidden from non-members everywhere (already hidden on profile list; verify all pages).
- Group Settings (UI + server)
  - Edit info (done via updateGroup) but needs a settings UI surface with role/permissions management.
  - Roles & creator constraints: creator cannot leave/be demoted; admins can manage admins/members; enforce at mutation level.
  - Permissions configuration: who can send invites (all/admins/custom), who can create pacts (all/admins). Likely requires additional schema.
- Activity system completeness
  - Log all event types: member_left, admin_promoted, admin_demoted, pact_created, pact_used, settings_changed (done), etc.
  - Surfaces in global feed (pagination or “show more”) and per-group feed; better event metadata formatting.
- Pacts
  - “Use Existing Pact” vs “Create New Pact” split; minimal mocked flow or one simple system pact (e.g., Group Fund) to visualize UI.
  - Wire up contractAddress/ABI UI stubs as non-functional placeholders if smart contracts not deployed yet.
- Chat
  - XMTP integration placeholder UI (tabs already include WIP placeholder). Add a minimal chat mock or integrate actual XMTP later.
- UX polish
  - Avatar stack click to open full member list modal.
  - Invite friends during Create Group (optional step) with a follow-up modal.
  - Better loading/empty/error states and toasts.


## Caveats and Notes

- Generated types: We added groups to convex/_generated/api.d.ts to enable imports. In a real Convex setup, this is generated by `npx convex dev`. When the backend is wired, regenerate instead of maintaining by hand.
- Join methods: Current schema uses a single joinMethod enum. The brief suggests allowing multiple join methods simultaneously (request + invite + nft). Consider changing to an array (e.g., joinMethods: v.array(v.union(...))) or a separate permissions/config table.
- Emoji picker: The Create Group modal uses a simple text input for emoji. A dedicated picker (e.g., Frimousse) is not yet integrated.
- Name uniqueness: Enforced per creator on create. If we add rename in settings, we must re-enforce uniqueness.


## Open Questions

1. Should groups support multiple join methods concurrently? If yes, we’ll switch from a single `joinMethod` to `joinMethods` (array) or a permissions/config model.
2. Should invites and access requests share the same table (e.g., groupAccess with type: invite/request), or stay separate structures? This affects moderation UI and query patterns.
3. Are group invites only ever between friends (as stated)? If yes, we’ll enforce a friendship check in invite mutations.
4. For permissions "Select members (custom)" who can send invites, do we expect a static list of userIds per group or role-based plus overrides? Proposal: a `groupPermissions` table.
5. Do we need a vanity slug for groups or strictly opaque ids? Currently navigating via id.
6. What data belongs in activity metadata for each event type to support rich rendering? We can agree on a minimal cross-event shape.
7. Should Public Groups on profile show member count and/or admin badges? Currently we only show the avatar stack with +X.
8. Are public groups visible to non-members on /groups/[id] beyond the access header? Brief specifies showing Access Component; currently we render the group header and Access panel; confirm desired behavior.


## Implementation Ideas and Recommendations

- Schema
  - Replace `joinMethod` with `joinMethods: v.array(v.literal("request" | "invite" | "nft"))` or add `groupPermissions` for more flexible toggles (invite policy, pact creation policy, custom allowlist).
  - Consider `groupRequests` table to cleanly model request access workflow separate from invitations.
  - Add `indexes` for common queries: `groupActivities.by_group_createdAt`, `groupInvitations.by_status`, etc., for sorted queries.
- Backend
  - Add helper utilities for authorization checks (isCreator, isAdmin, membership) to avoid duplication.
  - Add mutations for invite/send/cancel/accept; removeMember; leaveGroup with creator/admin rules enforced; promote/demote admin with activity logs.
  - Emit notifications for all group-related actions per brief (invite sent/cancelled/accepted, removed, joined).
- Frontend UX
  - Member list modal for avatar stack; pagination for large groups.
  - Dedicated Group Settings page/modal for role management and permissions.
  - Invite modal accessible from profile ("Send Group Invite") listing groups with per-group invite state.
  - Global feed: add pagination or “Show more”.
  - Use a proper emoji picker in the Create Group flow.
- Pacts
  - Add a minimal mocked “Group Fund” pact to demonstrate UI flow and activity generation (pact_created/pact_used entries).
- Testing & Types
  - Add TypeScript types for Convex documents (Id<"groups">, etc.) across components to reduce `any` usage.
  - E2E paths for group creation, listing, and activity feed; unit tests for Convex functions.


## Summary

Phase 1 scaffolding is in place: schema, creation flow, list and detail pages, basic activity tracking, and profile public groups. The remaining work centers on invitations/access control, settings/roles, full activity coverage, and the Pacts/Chat experiences. With these foundations, we can incrementally ship the flows outlined in the brief while keeping the data model flexible for future extensions.
